
/**
 * chaosleak.js
 * @author agsvn
 * @version 0.1
 * 
 * Remember to include sha1 function:
 * <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha1/0.6.0/sha1.min.js"></script>
 */

async function chaosleak(d,m){const t={};var n,_,i;return d.mode.hibp&&(n=await hibp(d["hibp-api"],m)),d.mode.mostcommon&&(_=await server(d["data-dir"],"mostcommon",m)),d.mode.lastchaos&&(i=await server(d["data-dir"],"lastchaos",md5(m))),t.hibp=n,t.mostcommon=_,t.lastchaos=i,t.found=n||_||i,t}async function server(d,m,t){if("mostcommon"==m){t.indexOf(["*","?","$","\\","/","<",">",'"',":","|","!",".","#","%","[","]","(",")","{","}"])>=0&&(n="special")}var n=t[0],_=!1;return await fetch(d+("mostcommon"==m?"most-common":"lastchaos")+"/"+n+".txt",{mode:"no-cors"}).then(d=>d.text()).then(d=>d.split("\n")).then(d=>{d.find(d=>d.match(t))&&(_=!0)}).then(d=>_).catch(d=>console.log(d))}async function hibp(d,m){let t=sha1(m).toUpperCase(),n=t.slice(0,5),_=t.slice(-5);var i=0;return await fetch(d+n).then(d=>d.text()).then(d=>d.split("\n").map(d=>{let[m,t]=d.split(":");m.includes(_)&&(i+=parseInt(t))})).then(d=>i).catch(d=>console.log(d))}var md5=function(d){return M(V(Y(X(d),8*d.length))).toLowerCase()};function M(d){for(var m,t="0123456789ABCDEF",n="",_=0;_<d.length;_++)m=d.charCodeAt(_),n+=t.charAt(m>>>4&15)+t.charAt(15&m);return n}function X(d){for(var m=Array(d.length>>2),t=0;t<m.length;t++)m[t]=0;for(t=0;t<8*d.length;t+=8)m[t>>5]|=(255&d.charCodeAt(t/8))<<t%32;return m}function V(d){for(var m="",t=0;t<32*d.length;t+=8)m+=String.fromCharCode(d[t>>5]>>>t%32&255);return m}function Y(d,m){d[m>>5]|=128<<m%32,d[14+(m+64>>>9<<4)]=m;for(var t=1732584193,n=-271733879,_=-1732584194,i=271733878,a=0;a<d.length;a+=16){var e=t,f=n,r=_,h=i;n=md5_ii(n=md5_ii(n=md5_ii(n=md5_ii(n=md5_hh(n=md5_hh(n=md5_hh(n=md5_hh(n=md5_gg(n=md5_gg(n=md5_gg(n=md5_gg(n=md5_ff(n=md5_ff(n=md5_ff(n=md5_ff(n,_=md5_ff(_,i=md5_ff(i,t=md5_ff(t,n,_,i,d[a+0],7,-680876936),n,_,d[a+1],12,-389564586),t,n,d[a+2],17,606105819),i,t,d[a+3],22,-1044525330),_=md5_ff(_,i=md5_ff(i,t=md5_ff(t,n,_,i,d[a+4],7,-176418897),n,_,d[a+5],12,1200080426),t,n,d[a+6],17,-1473231341),i,t,d[a+7],22,-45705983),_=md5_ff(_,i=md5_ff(i,t=md5_ff(t,n,_,i,d[a+8],7,1770035416),n,_,d[a+9],12,-1958414417),t,n,d[a+10],17,-42063),i,t,d[a+11],22,-1990404162),_=md5_ff(_,i=md5_ff(i,t=md5_ff(t,n,_,i,d[a+12],7,1804603682),n,_,d[a+13],12,-40341101),t,n,d[a+14],17,-1502002290),i,t,d[a+15],22,1236535329),_=md5_gg(_,i=md5_gg(i,t=md5_gg(t,n,_,i,d[a+1],5,-165796510),n,_,d[a+6],9,-1069501632),t,n,d[a+11],14,643717713),i,t,d[a+0],20,-373897302),_=md5_gg(_,i=md5_gg(i,t=md5_gg(t,n,_,i,d[a+5],5,-701558691),n,_,d[a+10],9,38016083),t,n,d[a+15],14,-660478335),i,t,d[a+4],20,-405537848),_=md5_gg(_,i=md5_gg(i,t=md5_gg(t,n,_,i,d[a+9],5,568446438),n,_,d[a+14],9,-1019803690),t,n,d[a+3],14,-187363961),i,t,d[a+8],20,1163531501),_=md5_gg(_,i=md5_gg(i,t=md5_gg(t,n,_,i,d[a+13],5,-1444681467),n,_,d[a+2],9,-51403784),t,n,d[a+7],14,1735328473),i,t,d[a+12],20,-1926607734),_=md5_hh(_,i=md5_hh(i,t=md5_hh(t,n,_,i,d[a+5],4,-378558),n,_,d[a+8],11,-2022574463),t,n,d[a+11],16,1839030562),i,t,d[a+14],23,-35309556),_=md5_hh(_,i=md5_hh(i,t=md5_hh(t,n,_,i,d[a+1],4,-1530992060),n,_,d[a+4],11,1272893353),t,n,d[a+7],16,-155497632),i,t,d[a+10],23,-1094730640),_=md5_hh(_,i=md5_hh(i,t=md5_hh(t,n,_,i,d[a+13],4,681279174),n,_,d[a+0],11,-358537222),t,n,d[a+3],16,-722521979),i,t,d[a+6],23,76029189),_=md5_hh(_,i=md5_hh(i,t=md5_hh(t,n,_,i,d[a+9],4,-640364487),n,_,d[a+12],11,-421815835),t,n,d[a+15],16,530742520),i,t,d[a+2],23,-995338651),_=md5_ii(_,i=md5_ii(i,t=md5_ii(t,n,_,i,d[a+0],6,-198630844),n,_,d[a+7],10,1126891415),t,n,d[a+14],15,-1416354905),i,t,d[a+5],21,-57434055),_=md5_ii(_,i=md5_ii(i,t=md5_ii(t,n,_,i,d[a+12],6,1700485571),n,_,d[a+3],10,-1894986606),t,n,d[a+10],15,-1051523),i,t,d[a+1],21,-2054922799),_=md5_ii(_,i=md5_ii(i,t=md5_ii(t,n,_,i,d[a+8],6,1873313359),n,_,d[a+15],10,-30611744),t,n,d[a+6],15,-1560198380),i,t,d[a+13],21,1309151649),_=md5_ii(_,i=md5_ii(i,t=md5_ii(t,n,_,i,d[a+4],6,-145523070),n,_,d[a+11],10,-1120210379),t,n,d[a+2],15,718787259),i,t,d[a+9],21,-343485551),t=safe_add(t,e),n=safe_add(n,f),_=safe_add(_,r),i=safe_add(i,h)}return Array(t,n,_,i)}function md5_cmn(d,m,t,n,_,i){return safe_add(bit_rol(safe_add(safe_add(m,d),safe_add(n,i)),_),t)}function md5_ff(d,m,t,n,_,i,a){return md5_cmn(m&t|~m&n,d,m,_,i,a)}function md5_gg(d,m,t,n,_,i,a){return md5_cmn(m&n|t&~n,d,m,_,i,a)}function md5_hh(d,m,t,n,_,i,a){return md5_cmn(m^t^n,d,m,_,i,a)}function md5_ii(d,m,t,n,_,i,a){return md5_cmn(t^(m|~n),d,m,_,i,a)}function safe_add(d,m){var t=(65535&d)+(65535&m);return(d>>16)+(m>>16)+(t>>16)<<16|65535&t}function bit_rol(d,m){return d<<m|d>>>32-m}