/**
 * chaosleak.js
 * @author agsvn
 * @version 0.2
 */

async function chaosleak(d,m){const t={};var n,a,r;return d.mode.hibp&&(n=await hibp(d["hibp-api"],m)),d.mode.mostcommon&&(a=await server(d["data-dir"],"mostcommon",m)),d.mode.lastchaos&&(r=await server(d["data-dir"],"lastchaos",md5(m))),t.hibp=n,t.mostcommon=a,t.lastchaos=r,t.found=n||a||r,t}async function server(d,m,t){var n=t[0];if("mostcommon"==m){["*","?","$","\\","/","<",">",'"',":","|","!",".","#","%","[","]","(",")","{","}"].forEach(d=>{d===n&&(n="special")})}var a=!1;return await fetch(d+("mostcommon"==m?"most-common":"lastchaos")+"/"+n+".txt",{mode:"no-cors"}).then(d=>d.text()).then(d=>d.split("\n")).then(d=>{d.find(d=>d.match("special"==n?t.replace(/([()[{*+.$^\\|?])/g,"\\$1"):t))&&(a=!0)}).then(d=>a).catch(d=>console.log(d))}async function hibp(d,m){let t=await sha1(m),n=t.slice(0,5),a=t.slice(-5);var r=0;return await fetch(d+n).then(d=>d.text()).then(d=>d.split("\n").map(d=>{let[m,t]=d.split(":");m.includes(a)&&(r+=parseInt(t))})).then(d=>r).catch(d=>console.log(d))}async function sha1(d){const m=(new TextEncoder).encode(d),t=await crypto.subtle.digest("SHA-1",m);return Array.from(new Uint8Array(t)).map(d=>d.toString(16).padStart(2,"0")).join("").toUpperCase()}var md5=function(d){return M(V(Y(X(d),8*d.length))).toLowerCase()};function M(d){for(var m,t="0123456789ABCDEF",n="",a=0;a<d.length;a++)m=d.charCodeAt(a),n+=t.charAt(m>>>4&15)+t.charAt(15&m);return n}function X(d){for(var m=Array(d.length>>2),t=0;t<m.length;t++)m[t]=0;for(t=0;t<8*d.length;t+=8)m[t>>5]|=(255&d.charCodeAt(t/8))<<t%32;return m}function V(d){for(var m="",t=0;t<32*d.length;t+=8)m+=String.fromCharCode(d[t>>5]>>>t%32&255);return m}function Y(d,m){d[m>>5]|=128<<m%32,d[14+(m+64>>>9<<4)]=m;for(var t=1732584193,n=-271733879,a=-1732584194,r=271733878,_=0;_<d.length;_+=16){var i=t,e=n,o=a,f=r;n=md5_ii(n=md5_ii(n=md5_ii(n=md5_ii(n=md5_hh(n=md5_hh(n=md5_hh(n=md5_hh(n=md5_gg(n=md5_gg(n=md5_gg(n=md5_gg(n=md5_ff(n=md5_ff(n=md5_ff(n=md5_ff(n,a=md5_ff(a,r=md5_ff(r,t=md5_ff(t,n,a,r,d[_+0],7,-680876936),n,a,d[_+1],12,-389564586),t,n,d[_+2],17,606105819),r,t,d[_+3],22,-1044525330),a=md5_ff(a,r=md5_ff(r,t=md5_ff(t,n,a,r,d[_+4],7,-176418897),n,a,d[_+5],12,1200080426),t,n,d[_+6],17,-1473231341),r,t,d[_+7],22,-45705983),a=md5_ff(a,r=md5_ff(r,t=md5_ff(t,n,a,r,d[_+8],7,1770035416),n,a,d[_+9],12,-1958414417),t,n,d[_+10],17,-42063),r,t,d[_+11],22,-1990404162),a=md5_ff(a,r=md5_ff(r,t=md5_ff(t,n,a,r,d[_+12],7,1804603682),n,a,d[_+13],12,-40341101),t,n,d[_+14],17,-1502002290),r,t,d[_+15],22,1236535329),a=md5_gg(a,r=md5_gg(r,t=md5_gg(t,n,a,r,d[_+1],5,-165796510),n,a,d[_+6],9,-1069501632),t,n,d[_+11],14,643717713),r,t,d[_+0],20,-373897302),a=md5_gg(a,r=md5_gg(r,t=md5_gg(t,n,a,r,d[_+5],5,-701558691),n,a,d[_+10],9,38016083),t,n,d[_+15],14,-660478335),r,t,d[_+4],20,-405537848),a=md5_gg(a,r=md5_gg(r,t=md5_gg(t,n,a,r,d[_+9],5,568446438),n,a,d[_+14],9,-1019803690),t,n,d[_+3],14,-187363961),r,t,d[_+8],20,1163531501),a=md5_gg(a,r=md5_gg(r,t=md5_gg(t,n,a,r,d[_+13],5,-1444681467),n,a,d[_+2],9,-51403784),t,n,d[_+7],14,1735328473),r,t,d[_+12],20,-1926607734),a=md5_hh(a,r=md5_hh(r,t=md5_hh(t,n,a,r,d[_+5],4,-378558),n,a,d[_+8],11,-2022574463),t,n,d[_+11],16,1839030562),r,t,d[_+14],23,-35309556),a=md5_hh(a,r=md5_hh(r,t=md5_hh(t,n,a,r,d[_+1],4,-1530992060),n,a,d[_+4],11,1272893353),t,n,d[_+7],16,-155497632),r,t,d[_+10],23,-1094730640),a=md5_hh(a,r=md5_hh(r,t=md5_hh(t,n,a,r,d[_+13],4,681279174),n,a,d[_+0],11,-358537222),t,n,d[_+3],16,-722521979),r,t,d[_+6],23,76029189),a=md5_hh(a,r=md5_hh(r,t=md5_hh(t,n,a,r,d[_+9],4,-640364487),n,a,d[_+12],11,-421815835),t,n,d[_+15],16,530742520),r,t,d[_+2],23,-995338651),a=md5_ii(a,r=md5_ii(r,t=md5_ii(t,n,a,r,d[_+0],6,-198630844),n,a,d[_+7],10,1126891415),t,n,d[_+14],15,-1416354905),r,t,d[_+5],21,-57434055),a=md5_ii(a,r=md5_ii(r,t=md5_ii(t,n,a,r,d[_+12],6,1700485571),n,a,d[_+3],10,-1894986606),t,n,d[_+10],15,-1051523),r,t,d[_+1],21,-2054922799),a=md5_ii(a,r=md5_ii(r,t=md5_ii(t,n,a,r,d[_+8],6,1873313359),n,a,d[_+15],10,-30611744),t,n,d[_+6],15,-1560198380),r,t,d[_+13],21,1309151649),a=md5_ii(a,r=md5_ii(r,t=md5_ii(t,n,a,r,d[_+4],6,-145523070),n,a,d[_+11],10,-1120210379),t,n,d[_+2],15,718787259),r,t,d[_+9],21,-343485551),t=safe_add(t,i),n=safe_add(n,e),a=safe_add(a,o),r=safe_add(r,f)}return Array(t,n,a,r)}function md5_cmn(d,m,t,n,a,r){return safe_add(bit_rol(safe_add(safe_add(m,d),safe_add(n,r)),a),t)}function md5_ff(d,m,t,n,a,r,_){return md5_cmn(m&t|~m&n,d,m,a,r,_)}function md5_gg(d,m,t,n,a,r,_){return md5_cmn(m&n|t&~n,d,m,a,r,_)}function md5_hh(d,m,t,n,a,r,_){return md5_cmn(m^t^n,d,m,a,r,_)}function md5_ii(d,m,t,n,a,r,_){return md5_cmn(t^(m|~n),d,m,a,r,_)}function safe_add(d,m){var t=(65535&d)+(65535&m);return(d>>16)+(m>>16)+(t>>16)<<16|65535&t}function bit_rol(d,m){return d<<m|d>>>32-m}